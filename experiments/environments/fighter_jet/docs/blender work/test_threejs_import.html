<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fighter Jet Cockpit - Three.js Test</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3>Fighter Jet Cockpit - Phase 3 Export Test</h3>
        <p>Loading: <span id="status">Initializing...</span></p>
        <p>Triangles: <span id="triangles">0</span></p>
        <p>Textures: <span id="textures">0</span></p>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x222222);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        // Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // Load Phase 3 exports
        const loader = new GLTFLoader();
        const statusElement = document.getElementById('status');
        const trianglesElement = document.getElementById('triangles');
        const texturesElement = document.getElementById('textures');

        let totalTriangles = 0;
        let totalTextures = 0;

        // Test different LOD levels
        const lodLevels = ['hero', 'high', 'medium', 'low'];
        let currentLOD = 0;

        function loadLOD(lodLevel) {
            statusElement.textContent = `Loading ${lodLevel} quality...`;
            
            // Clear previous model
            const existingModel = scene.getObjectByName('cockpit');
            if (existingModel) {
                scene.remove(existingModel);
            }

            loader.load(
                `./exports/${lodLevel}/fighter_cockpit_${lodLevel}.glb`,
                (gltf) => {
                    const model = gltf.scene;
                    model.name = 'cockpit';
                    
                    // Calculate statistics
                    totalTriangles = 0;
                    totalTextures = 0;
                    
                    model.traverse((child) => {
                        if (child.isMesh) {
                            totalTriangles += child.geometry.attributes.position.count / 3;
                            if (child.material.map) totalTextures++;
                            if (child.material.normalMap) totalTextures++;
                            if (child.material.roughnessMap) totalTextures++;
                            if (child.material.metalnessMap) totalTextures++;
                        }
                    });
                    
                    scene.add(model);
                    
                    // Update UI
                    statusElement.textContent = `${lodLevel.toUpperCase()} quality loaded successfully`;
                    trianglesElement.textContent = Math.floor(totalTriangles).toLocaleString();
                    texturesElement.textContent = totalTextures;
                    
                    // Position camera
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    
                    camera.position.set(center.x + size.x, center.y + size.y, center.z + size.z);
                    controls.target.copy(center);
                    controls.update();
                },
                (progress) => {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    statusElement.textContent = `Loading ${lodLevel} quality... ${percent}%`;
                },
                (error) => {
                    console.error('Error loading model:', error);
                    statusElement.textContent = `Error loading ${lodLevel} quality`;
                }
            );
        }

        // Load initial LOD
        loadLOD(lodLevels[currentLOD]);

        // Keyboard controls for LOD switching
        window.addEventListener('keydown', (event) => {
            switch(event.key) {
                case '1':
                    currentLOD = 0;
                    loadLOD(lodLevels[currentLOD]);
                    break;
                case '2':
                    currentLOD = 1;
                    loadLOD(lodLevels[currentLOD]);
                    break;
                case '3':
                    currentLOD = 2;
                    loadLOD(lodLevels[currentLOD]);
                    break;
                case '4':
                    currentLOD = 3;
                    loadLOD(lodLevels[currentLOD]);
                    break;
            }
        });

        // Render loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();

        // Add instructions
        setTimeout(() => {
            const instructions = document.createElement('div');
            instructions.style.cssText = `
                position: absolute;
                bottom: 10px;
                left: 10px;
                color: white;
                font-family: Arial, sans-serif;
                background: rgba(0,0,0,0.7);
                padding: 10px;
                border-radius: 5px;
                font-size: 12px;
            `;
            instructions.innerHTML = `
                <strong>Controls:</strong><br>
                • Mouse: Orbit camera<br>
                • Keys 1-4: Switch LOD levels<br>
                • 1: Hero | 2: High | 3: Medium | 4: Low
            `;
            document.body.appendChild(instructions);
        }, 2000);
    </script>
</body>
</html>
